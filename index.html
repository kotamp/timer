<head>
  <style>
    body {
      background: #000;
      font-family: FreeSans, sans-serif;
    }
    #time, #info {
      display: inline-block;
      padding: 0;
      margin: 0;
    }
  </style>
</head>
<body>
  <h1 id="time"></h1>
  <p id="info"></p>
  <audio id="time-is-now"><source src="time-is-now.mp3" type="audio/mpeg"></audio>
  <audio id="point-blank"><source src="point-blank.mp3" type="audio/mpeg"></audio>
  <script>
  try {

    const permutations = function(str) {
      let arr = [];

      arr.push(str[0] + str[1] + str[2]);
      arr.push(str[0] + str[2] + str[1]);
      arr.push(str[1] + str[0] + str[2]);
      arr.push(str[1] + str[2] + str[0]);
      arr.push(str[2] + str[0] + str[1]);
      arr.push(str[2] + str[1] + str[0]);

      return arr
    };

    const COLOR = permutations("d29").map((e) => ('#'+e));

    let coef = 0.7;
    let cycleDuration = 147;
    let reactionTime = 2;

    let state = 0; // 0 - reaction, 1 - anki, 2 - anime
    let startTime = performance.now();
    let canPlay = true;

    let ankiTime = Math.floor((cycleDuration - 2 * reactionTime) * coef);
    let animeTime = cycleDuration - ankiTime - 2 * reactionTime;

    const el = document.getElementById('time');
    document.getElementById('info').innerHTML = '' + ankiTime + ' / ' + animeTime + ' - ' + coef;

    const firstSound = document.getElementById("point-blank");
    const secondSound = document.getElementById("time-is-now");

    const update = function() {
      const time = performance.now();
      const d = Math.floor((time - startTime) / 1000) % (2 * reactionTime + ankiTime + animeTime); 
      let text, color;


	    if (d < reactionTime){
		    if (canPlay) firstSound.play();
		    canPlay = false;
		    text = "Switch to anki";
		    color = 0;
	    } else if (d < reactionTime + ankiTime) {
		    canPlay = true;
		    text = "Anki";
		    color = 1;

	    } else if (d < reactionTime + ankiTime + reactionTime) {
		    if (canPlay) secondSound.play()
		    canPlay = false;
		    text = "Switch to anime";
		    color = 2;
	    }
	    else if (d < reactionTime + ankiTime + reactionTime + animeTime) {

	    text = "Anime :)";
		    color = 3;
		    canPlay = true;
	    }

      
      el.innerText = text + " " + d;
      document.body.style.color = COLOR[color];


    };
    setInterval(update, 1000);
} catch (e) {
  alert(e);
}
  </script>
</body>
